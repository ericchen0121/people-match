nflTeams = [ 
  'TEN',
  'BUF',
  'MIA',
  'NYJ',
  'NE',
  'CIN',
  'CLE',
  'BAL',
  'PIT',
  'IND',
  'JAC',
  'HOU',
  'DEN',
  'SD',
  'KC',
  'OAK',
  'DAL',
  'PHI',
  'NYG',
  'WAS',
  'CHI',
  'DET',
  'GB',
  'MIN',
  'TB',
  'ATL',
  'CAR',
  'NO',
  'SF',
  'ARI',
  'STL',
  'SEA'
]

# TODO: 2014 Playoff Teams, Replace for 2015!
playoffTeams = ['NE', 'SEA', 'GB', 'IND'] 

nbaTeams =  [
            {
                "id": "583ec8d4-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Wizards",
                "market": "Washington",
                "alias": "WAS"
            }, {
                "id": "583ec97e-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Hornets",
                "market": "Charlotte",
                "alias": "CHA"
            }, {
                "id": "583ecb8f-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Hawks",
                "market": "Atlanta",
                "alias": "ATL"
            }, {
                "id": "583ecea6-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Heat",
                "market": "Miami",
                "alias": "MIA"
            }, {
                "id": "583ed157-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Magic",
                "market": "Orlando",
                "alias": "ORL"
            }, {
                "id": "583ec70e-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Knicks",
                "market": "New York",
                "alias": "NYK"
            }, {
                "id": "583ec87d-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "76ers",
                "market": "Philadelphia",
                "alias": "PHI"
            }, {
                "id": "583ec9d6-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Nets",
                "market": "Brooklyn",
                "alias": "BKN"
            }, {
                "id": "583eccfa-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Celtics",
                "market": "Boston",
                "alias": "BOS"
            }, {
                "id": "583ecda6-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Raptors",
                "market": "Toronto",
                "alias": "TOR"
            }, {
                "id": "583ec5fd-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Bulls",
                "market": "Chicago",
                "alias": "CHI"
            }, {
                "id": "583ec773-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Cavaliers",
                "market": "Cleveland",
                "alias": "CLE"
            }, {
                "id": "583ec7cd-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Pacers",
                "market": "Indiana",
                "alias": "IND"
            }, {
                "id": "583ec928-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Pistons",
                "market": "Detroit",
                "alias": "DET"
            }, {
                "id": "583ecefd-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Bucks",
                "market": "Milwaukee",
                "alias": "MIL"
            }, {
                "id": "583eca2f-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Timberwolves",
                "market": "Minnesota",
                "alias": "MIN"
            }, {
                "id": "583ece50-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Jazz",
                "market": "Utah",
                "alias": "UTA"
            }, {
                "id": "583ecfff-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Thunder",
                "market": "Oklahoma City",
                "alias": "OKC"
            }, {
                "id": "583ed056-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Trail Blazers",
                "market": "Portland",
                "alias": "POR"
            }, {
                "id": "583ed102-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Nuggets",
                "market": "Denver",
                "alias": "DEN"
            }, {
                "id": "583eca88-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Grizzlies",
                "market": "Memphis",
                "alias": "MEM"
            }, {
                "id": "583ecb3a-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Rockets",
                "market": "Houston",
                "alias": "HOU"
            }, {
                "id": "583ecc9a-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Pelicans",
                "market": "New Orleans",
                "alias": "NOP"
            }, {
                "id": "583ecd4f-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Spurs",
                "market": "San Antonio",
                "alias": "SAS"
            }, {
                "id": "583ecf50-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Mavericks",
                "market": "Dallas",
                "alias": "DAL"
            }, {
                "id": "583ec825-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Warriors",
                "market": "Golden State",
                "alias": "GSW"
            }, {
                "id": "583ecae2-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Lakers",
                "market": "Los Angeles",
                "alias": "LAL"
            }, {
                "id": "583ecdfb-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Clippers",
                "market": "Los Angeles",
                "alias": "LAC"
            }, {
                "id": "583ecfa8-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Suns",
                "market": "Phoenix",
                "alias": "PHX"
            }, {
                "id": "583ed0ac-fb46-11e1-82cb-f4ce4684ea4c",
                "name": "Kings",
                "market": "Sacramento",
                "alias": "SAC"
            }]

Meteor.methods

  # function getAthletesByTeamNFL
  #
  # This method adds the SD Player Id to the existing player's object.
  # This method initially was for adding Data to Seed Data
  # There are a few scenarios: 
  # 1) new player
  # 2) existing player, new information (team change, most likely)
  # 3) duplicate name, yet different player. (difficult, may need to add other identifer on there - jersey-team-last-name)
  # If the athlete doesn't exist yet, it adds them.
  #
  getAthletesByTeamNFL: (team) ->
    console.log '-------------  ' + team + ': UPDATING ROSTERS -------------'
    roster = JSON.parse(sd.NFLApi.getTeamRoster team)
    players = roster["players"]
    new_players = [] # for debugging and adding new ESPN images

    for player in players
      existingPlayer = NflPlayers.findOne({ "api.SDPlayerId": player.id }) # if player is in db
      if existingPlayer
        if !existingPlayer.api || !existingPlayer.api.SDPlayerId
          NflPlayers.update(
            { full_name: existingPlayer.full_name, team_id: roster.id }, # find player uniquely
            { $set: { 
                "api.SDPlayerId": player.id  # add the api id key to the player
                #
                # in case these changed
                #
                position: player.position 
                jersey_number: player.jersey_number
                team: roster.market + ' ' + roster.name
                team_id: roster.id
                height: player.height
                weight: player.weight
                status: player.status
                salary: player.salary
                experience: player.experience
              }
            }
          )
          console.log 'API ID ADDED for' + player.name_full + ' ' + roster.market +  ' ' + player.position
      else # if athlete doesn't exist, insert him
        NflPlayers.insert({
          full_name: player.name_full
          first_name: player.name_first
          last_name: player.name_last
          birthdate: player.birthdate
          height: player.height
          weight: player.weight
          college: player.college
          status: player.status
          salary: player.salary
          experience: player.experience
          jersey_number: player.jersey_number
          position: player.position
          team: roster.market + ' ' + roster.name
          team_id: roster.id
          api: {
            SDPlayerId: player.id
          }
        })
        
        #
        # DEBUGGING
        #
        new_players.push({name: player.name_full, api_id: player.id, team: roster.id})
    #
    # DEBUGGING
    #
    console.log 'NEW PLAYERS, ADD IMAGES TO:--------------------', new_players, " Total New Players", new_players.length

  updateAllTeamRostersNFL: ->
    # Meteor.setInterval works, the code is cracked! 
    # docs: http://stackoverflow.com/questions/15229141/simple-timer-in-meteor-js
    # 
    i = 0
    len = nflTeams.length
    timer = Meteor.setInterval( ->
      if i >= len
        Meteor.clearInterval timer
      else
        Meteor.call 'getAthletesByTeamNFL', nflTeams[i]
        i++
    , 5000)

    return null

Meteor.call 'updateAllTeamRostersNFL'
# Meteor.call 'getAthletesByTeamNFL', 'BAL'
  #
  #
  # NBA METHODS
  #
  # 
  # # @param alias [string] team abbreviation, ie. BOS
  # # @return [string] team SD Id
  # getTeamIdNBA: (alias) ->
  #   for team in nbaTeams
  #     if alias.toLowerCase() == team.alias.toLowerCase()
  #       return team.id

  # # Adds SDPlayerId to Athlete
  # # 
  # getAthletesByTeamNBA: (alias) ->
  #   id = Meteor.call 'getTeamIdNBA', alias
  #   roster = JSON.parse sd.NBAApi.getTeamProfile(id)
  #   players = roster.players

  #   for player in players
  #     # IF PLAYER IS IN DB (TO ENRICH DATA WITH API.SDAPI)
  #     # NOTE: search for combination of full_name, position and jersey_number?
  #     existingPlayer = Athletes.findOne({ sport: 'NBA', full_name: player.full_name, jersey_number: parseInt(player.jersey_number) })
  #     if existingPlayer # if existing, add the id to the player
  #       if !existingPlayer.api || !existingPlayer.api.SDPlayerId
  #         Athletes.update(
  #           { _id: existingPlayer._id },
  #           { $set: { 
  #               "api.SDPlayerId": player.id 
  #             }
  #           }
  #         )

  # updateAllTeamRostersNBA: ->
  #   i = 0
  #   len = nbaTeams.length

  #   timer = Meteor.setInterval( ->
  #     if i is len
  #       Meteor.clearInterval timer
  #     else
  #       Meteor.call 'getAthletesByTeamNBA', nbaTeams[i].alias
  #       i++
  #   , 2500)
  # return null
        
# Meteor.call 'getAthletesByTeamNBA', 'BOS'
# Meteor.call 'updateAllTeamRostersNBA'
